# A/B Test



## 0. AB测试是什么？

AB测试是一种工具，通过科学的实验设计、采样样本代表性、流量分割与小流量测试等方式来获得具有代表性的实验结论，并确信该结论在推广到全部流量时是可信的。



## 1. 什么情况应该使用AB方案？

1. 产品到了相对成熟的阶段，需要通过优化现有的方案细节来寻求突破
2. 产品用户量级和使用量很大，需要小心翼翼的改动
3. 两个或多个方案的优劣难以判断，且预估效果会有比较明显的差距，需要通过实验来证实
4. 需要测试的方案要有足够明确、可以准确统计的指标来说明方案的优劣



## 2. 如何设计AB方案

### 2.1 确定要提升的目标

明确实验方案是针对哪一个或多个可统计的指标的，如落地页转化率、按钮点击率等。

给出预期需要的测试时间和提升效果。

给出对实验后果的接受程度。

### 2.2 有效的实验分组（样本选择）

为保证实验有效，样本的选择需要达到以下条件：

##### 2.3.1 足够的数量规模

样本数量需要达到一定规模时，得到的结果才可能置信。可以某一套计算公式，根据当前数据情况、目标增量、置信度，来反推达到置信结果所需的最小样本数量，https://www.evanmiller.org/ab-testing/sample-size.html

##### 2.3.2 如何保证AB样本的相似性/无偏性

结果上看解释就是，如果实验在10%流量上测试能提高1w，在100%流量上就能提升10w。这一步的本质是保证分组算法要足够随机，排除掉其他协变量的干扰，保证AB实验的差异是由测试元素而不是分组不均导致的。

样本基本属性之间存在关联、或者在同一流量池中同时进行多个实验导致样本属性之间产生了关联特征，都会引入非测试元素变量。可以使用hash函数、正交表等手段，来保证各层采用的分流策略是正交的，即各方案的分流是相互独立、互不影响的。



### 2.3 数据分析

##### 2.3.1 置信分析

1. 数据有效性，要确保采集的数据（埋点等）是正确无误的。
2. 样本有效性，分析前需要排查样本量是否足够、分组是否均匀。
3. 结论显著性，AB方案的差异属于正常波动，还是确实由实验因素引起。

##### 2.3.2 效果分析

1. 北极星指标看，哪个方案更好？

2. ROI角度看，哪个效益更高？

3. 时间维度看，长期、短期，哪个效果更好？

4. 用户维度看，对不同用户群体有差异吗？本质是看细分维度下的效果，观察流量划分时没有纳入考虑的维度，可能对实验结果有完全不同的表现，如某方案A在老用户群体中表现优于B，但在新用户群体中表现不如B

    

### 2.4 反馈闭环，融入工作流程





## 3. A/B test的局限性

1. 高收益背后是高成本：实验时间、多个版本的开发、只有25%的实验成功率（得到有意义的结论）
2. 本质只是一个实验，用来验证方案是否靠谱，代替不了想法本身。只能用于优化，不能用于创造，通常只能在已知的范围内进行，很难实现突破
3. AB测试更适合简单、需要短期见效、目标明确、指标可统计的情况，对于长期的、复杂的设计，很难轻易反映出AB方案的优劣。
4. 缺乏对间接影响的关注
5. 容易使人过分关注AB测试，丢失大局



## 4. 补充知识点

#### 卡方检验

卡方检验就是统计样本的实际观测值与理论推断值之间的偏离程度，实际观测值与理论推断值之间的偏离程度就决定卡方值的大小，如果卡方值越大，二者偏差程度越大；反之，二者偏差越小；若两个值完全相等时，卡方值就为0，表明理论值完全符合。

### t检验



### 新奇效应

新出现的东西，用户觉得新鲜，导致转化率高，但是过一段时间之后可能会趋于平庸。这种可能需要持续实验一段时间，待数据稳定之后再做评估，才能推测该方案的长期效果



### hash算法

参考 https://www.jianshu.com/p/f9239c9377c5

对象：X
关键码：X.key，对象的关键值，用于作为自变量
散列( hash )函数：h( )
散列地址：h(X.key)

核心原理：通过散列函数决定对象关键值和散列地址之间的关系，实现数据的组织存储和检索。

作用：通过牺牲一定的存储空间（散列空间比节点集合大），来提升检索效率。同时由于不同的节点可能存在相同的关键值、或不同的关键值通过散列函数得到相同的详列地址（冲突现象），需要处理这种情况。

散列函数的选取：

1. 尽可能简单的运算
2. 函数值域必须在散列表范围之内
3. 尽可能让节点均匀分布（提升检索效率、减少冲突）



#### 辛普森效应与区群谬误

以偏概全和以全概偏



## 参考文章

1. 什么是 A/B 测试？ - 腾讯技术工程的回答 - 知乎 https://www.zhihu.com/question/20045543/answer/1103961403
2. 《A/B test到底应该怎么做》https://www.zhihu.com/question/22537349/answer/620073169